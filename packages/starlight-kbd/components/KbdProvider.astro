<script is:inline>
  window.StarlightKbdProvider = (() => {
    const detectorRegexs = { apple: /mac|ipad|iphone/i, linux: /linux/i, windows: /win/i }
    return {
      matchedType: null,
      updateKbdPickers(type) {
        for (const select of document.querySelectorAll('starlight-kbd-picker select')) {
          let detectors = {}
          let isKnownType = false
          for (const option of Array.from(select.options)) {
            if (option.value === type) isKnownType = true
            const detector = option.dataset['detector']
            if (detector) detectors[detector] = option.value
          }
          if (isKnownType) {
            select.value = type
            continue
          } else if (this.matchedType) {
            select.value = this.matchedType
            continue
          }
          const platform = navigator.userAgentData?.platform || navigator.platform || navigator.userAgent
          for (const [detector, type] of Object.entries(detectors)) {
            const detectorRegex = detectorRegexs[detector]
            if (!detectorRegex) continue
            if (detectorRegex.test(platform)) {
              this.matchedType = type
              select.value = type
              break
            }
          }
        }
      },
    }
  })()
</script>
