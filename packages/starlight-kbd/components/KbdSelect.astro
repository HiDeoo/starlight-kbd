---
import config from 'virtual:starlight-kbd/config'

import Select from './Select.astro'

// TODO(HiDeoo) label
// TODO(HiDeoo) width/coud it be CSS property?

let value = ''
const options = config.types.map((type) => {
  if (type.default) value = type.id
  return {
    label: type.label,
    selected: type.default,
    value: type.id,
  }
})
---

<starlight-kbd-select>
  <Select label={Astro.locals.t('themeSelect.accessibleLabel')} {options} {value} width="6.25em" />
</starlight-kbd-select>

<script is:inline>
  StarlightKbdProvider.updateKbdSelects()
</script>

<script>
  customElements.define(
    'starlight-kbd-select',
    class StarlightKbdSelect extends HTMLElement {
      constructor() {
        super()

        this.querySelector('select')?.addEventListener('change', (event) => {
          if (!(event.currentTarget instanceof HTMLSelectElement)) return

          for (const kbd of document.querySelectorAll('[data-sl-kbd-type]')) {
            if (kbd.getAttribute('data-sl-kbd-type') === event.currentTarget.value) {
              kbd.setAttribute('data-sl-kbd-active', '')
            } else {
              kbd.removeAttribute('data-sl-kbd-active')
            }
          }

          if (typeof localStorage !== 'undefined') {
            localStorage.setItem('sl-kbd-type', event.currentTarget.value)
          }
        })
      }
    },
  )
</script>
